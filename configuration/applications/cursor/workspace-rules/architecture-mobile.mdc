---
description: Clean Architecture rules for TypeScript mobile projects
globs:
alwaysApply: true
---

# ğŸ—ï¸ Clean Architecture â€“ Mobile

These rules codify how every mobile project should be structured so that code remains **predictable, portable, and a joy to iterate on**.

> "UI is just a function of state â€“ keep state clean and the UI will follow." â€“ Rule #0

---

## 1. Architecture Overview

### 1.1 Directory Organization

```
<repo>
  src/
  â”œâ”€â”€ domain/                             # Pure business concepts
  â”‚   â”œâ”€â”€ entities/                       # Domain entities
  â”‚   â””â”€â”€ value-objects/                  # Value objects
  â”œâ”€â”€ application/                        # Use-cases & ports
  â”‚   â”œâ”€â”€ use-cases/                      # Application use cases
  â”‚   â””â”€â”€ ports/
  â”‚       â”œâ”€â”€ inbound/                    # Inbound ports
  â”‚       â””â”€â”€ outbound/                   # Outbound ports
  â”œâ”€â”€ infrastructure/                     # Platform & side-effects
  â”‚   â”œâ”€â”€ internationalization/           # Internationalization
  â”‚   â”œâ”€â”€ providers/                      # External API providers
  â”‚   â”œâ”€â”€ persistence/                    # Storage adapters
  â”‚   â”œâ”€â”€ repositories/                   # State management repositories
  â”‚   â””â”€â”€ navigation/                     # Navigation configuration
  â”œâ”€â”€ presentation/                       # UI layer
  â”‚   â”œâ”€â”€ design-system/                  # Design tokens & theming
  â”‚   â”‚   â”œâ”€â”€ tokens/                     # Design tokens
  â”‚   â”‚   â”‚   â”œâ”€â”€ colors.ts               # Color palette & semantic colors
  â”‚   â”‚   â”‚   â”œâ”€â”€ spacing.ts              # Spacing scale
  â”‚   â”‚   â”‚   â”œâ”€â”€ typography.ts           # Font families, sizes, weights
  â”‚   â”‚   â”‚   â””â”€â”€ animations.ts           # Animation durations & easings
  â”‚   â”‚   â”œâ”€â”€ themes/                     # Theme definitions
  â”‚   â”‚   â”‚   â”œâ”€â”€ light.ts                # Light theme values
  â”‚   â”‚   â”‚   â”œâ”€â”€ dark.ts                 # Dark theme values
  â”‚   â”‚   â”‚   â””â”€â”€ platform.ts             # iOS/Android adaptations
  â”‚   â”‚   â””â”€â”€ providers/                  # Theme context & providers
  â”‚   â”‚       â”œâ”€â”€ theme-provider.tsx      # Theme context provider
  â”‚   â”‚       â””â”€â”€ theme-hooks.ts          # useTheme, useColorScheme hooks
  â”‚   â”œâ”€â”€ features/
  â”‚   â”‚   â””â”€â”€ {entities}/                 # {Entity} feature module
  â”‚   â”‚       â”œâ”€â”€ components/             # Feature components
  â”‚   â”‚       â”œâ”€â”€ hooks/                  # Feature hooks
  â”‚   â”‚       â””â”€â”€ __tests__/              # Component unit tests
  â”‚   â”œâ”€â”€ shared/
  â”‚   â”‚   â”œâ”€â”€ components/
  â”‚   â”‚   â”‚   â”œâ”€â”€ atoms/                  # Atomic components
  â”‚   â”‚   â”‚   â”œâ”€â”€ molecules/              # Molecular components
  â”‚   â”‚   â”‚   â””â”€â”€ organisms/              # Organism components
  â”‚   â”‚   â”œâ”€â”€ hooks/                      # Shared hooks
  â”‚   â”‚   â””â”€â”€ utils/                      # UI utilities
  â”‚   â”œâ”€â”€ navigation/                     # Navigation components
  â”‚   â””â”€â”€ screens/                        # Application screens
  â”œâ”€â”€ di/                                 # Dependency injection
  â”œâ”€â”€ types/                              # Global types (to avoid)
  â””â”€â”€ shared/                             # Cross-cutting utilities (to avoid)
```

### 1.2 Module-By-Feature (optional)

For large apps, wrap the above folders inside `modules/<feature>/` to isolate bounded contexts.

### 1.3 File Naming Conventions

| Type             | Filename Pattern        | Class/Export Pattern  | Example                                                      |
| ---------------- | ----------------------- | --------------------- | ------------------------------------------------------------ |
| **Entity**       | `{name}.entity.ts`      | `{Name}`              | `{entity}.entity.ts` â†’ `{Entity}`                            |
| **Value Object** | `{name}.vo.ts`          | `{Name}`              | `{value}.vo.ts` â†’ `{Value}`                                  |
| **Use Case**     | `verb-noun.use-case.ts` | `{VerbNoun}UseCase`   | `{verb}-{entity}.use-case.ts` â†’ `{Verb}{Entity}UseCase`      |
| **Port**         | `{name}.port.ts`        | `{Name}Port`          | `{entity}-repository.port.ts` â†’ `{Entity}RepositoryPort`     |
| **Provider**     | `{name}.provider.ts`    | `{Name}Provider`      | `{entity}.provider.ts` â†’ `{Entity}Provider`                  |
| **Repository**   | `{name}.repository.ts`  | `{Name}Repository`    | `{impl}-{entity}.repository.ts` â†’ `{Impl}{Entity}Repository` |
| **Component**    | `{name}.tsx`            | `{Name}` (PascalCase) | `{entity}-card.tsx` â†’ `{Entity}Card`                         |
| **Hook**         | `use-{name}.ts`         | `use{Name}`           | `use-{entities}.ts` â†’ `use{Entities}`                        |
| **Design Token** | `{name}.ts`             | `{name}Tokens`        | `colors.ts` â†’ `colorTokens`                                  |
| **Theme**        | `{name}.ts`             | `{name}Theme`         | `light.ts` â†’ `lightTheme`                                    |
| **Provider**     | `{name}-provider.tsx`   | `{Name}Provider`      | `theme-provider.tsx` â†’ `ThemeProvider`                       |

---

## 2. Dependency Rules

```
 domain           â†’   âœ–  nothing
 application      â†’   domain
 infrastructure   â†’   application + domain
 presentation     â†’   application (never directly infrastructure)
 di               â†’   all layers
 shared           â†’   âœ–  nothing
```

---

## 3. Implementation Guidelines

1. **Functional & declarative** â€“ Components are pure functions; prefer hooks over class components.
2. **Early returns & guard clauses** â€“ keep render and logic flat.
3. **State strategy**
   â€¢ Local component state with `useState` when truly local.
   â€¢ Global cross-screen state via **Zustand** stores behind repositories.
4. **Zod validation** â€“ All external data (API, storage, env) validated at boundaries.
5. **Error handling**
   â€¢ Expected errors returned as `Result`.
   â€¢ Unexpected errors caught by an ErrorBoundary (presentation) or global handler (native log).
6. **No side-effects in domain & application** â€“ All I/O lives in providers/persistence.
7. **Platform code** â€“ Use file suffixes `.ios`, `.android`, `.native` when diverging.
8. **File size** â€“ â‰¤ 250 lines for UI, â‰¤ 300 elsewhere; split if larger.

---

## 4. Dependency Injection

â€¢ One `container.ts` exporting `createContainer()` that wires concrete implementations.
â€¢ Factories named `<token>Factory`.
â€¢ Never import container directly in production code â€“ always via `useContainer()`.

---

## 5. Patterns Catalog

â€¢ **Atomic Design** â€“ atoms/molecules/organisms for shared components.
â€¢ **Repository Pattern** â€“ bridges store â†”ï¸ application use cases.
â€¢ **Provider Pattern** â€“ wraps remote APIs / SDKs / sensors.
â€¢ **Hook Facade** â€“ each feature exposes a single hook (`useBookmarks`) that glues UI â†”ï¸ use cases.
â€¢ **Navigation Container** â€“ own folder under `infrastructure/navigation` with typed params.
â€¢ **Design System** â€“ tokens in `presentation/design-system/tokens/`, themes in `themes/`, consumed via Context providers.
â€¢ **Theme Management** â€“ light/dark themes with platform adaptations, accessed via `useTheme()` hook.
â€¢ **Design Tokens** â€“ semantic color names (`primary`, `surface`), spacing scale (`xs`, `sm`, `md`), type scale.

---

## 6. Best Practices

- âœ… **DO** validate external data with Zod schemas
- âœ… **DO** respect layer import rules
- âœ… **DO** export public types from `index.ts`

- âœ… **DO** support dark mode & RTL layouts
- âœ… **DO** use semantic color names (`primary`, `surface`) not hex values
- âœ… **DO** define spacing as multiples of base unit (4px, 8px, 12px, 16px)
- âœ… **DO** use dependency injection via context

- âŒ **DON'T** commit `console.log` statements
- âŒ **DON'T** import infrastructure directly in presentation
- âŒ **DON'T** put business logic in components
- âŒ **DON'T** skip accessibility features
- âŒ **DON'T** hardcode colors/spacing in components
- âŒ **DON'T** mix platform-specific styling with tokens
- âŒ **DON'T** exceed 250 lines for UI components
